<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Payment Method</title>
    <style>
        body {
            font-family: 'Sarabun', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .input-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }
        .result.success {
            background: #d1fae5;
            border: 2px solid #10b981;
            display: block;
        }
        .result.error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            display: block;
        }
        .info-box {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .code-block {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .highlight {
            background: #fef3c7;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }
        .check-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .check-pass {
            background: #d1fae5;
            color: #065f46;
        }
        .check-fail {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Payment Method ‡∏Ç‡∏≠‡∏á Order</h1>
        
        <div class="info-box">
            <p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong></p>
            <ol>
                <li>‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Order ID) ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</li>
                <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"</li>
                <li>‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ß‡πà‡∏≤ payment_method ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£</li>
                <li>‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
            </ol>
        </div>

        <div class="input-group">
            <label for="orderId">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Order ID):</label>
            <input type="number" id="orderId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 8" value="8">
        </div>

        <button onclick="checkOrder()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        async function checkOrder() {
            const orderId = document.getElementById('orderId').value;
            const resultDiv = document.getElementById('result');
            
            if (!orderId) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<p>‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>';
                return;
            }

            resultDiv.className = 'result';
            resultDiv.innerHTML = '<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>';
            resultDiv.style.display = 'block';

            try {
                const response = await fetch(`http://localhost:5000/api/orders/${orderId}`);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }

                const order = data.data || data;
                
                // Check if upload section should show
                const method = (order.payment_method || '').toLowerCase();
                const shouldShow = method === 'bank_transfer' || 
                                 method === 'bank transfer' || 
                                 method === 'promptpay' || 
                                 method === 'prompt_pay';

                let html = '<h2>‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h2>';
                
                html += '<div class="info-box">';
                html += `<p><strong>Order ID:</strong> ${order.id}</p>`;
                html += `<p><strong>Order Number:</strong> ${order.order_number || 'N/A'}</p>`;
                html += `<p><strong>Status:</strong> ${order.status}</p>`;
                html += `<p><strong>Total:</strong> ‡∏ø${order.total_amount}</p>`;
                html += '</div>';

                html += '<h3>üìã Payment Method</h3>';
                html += '<div class="code-block">';
                html += `payment_method: "<span class="highlight">${order.payment_method}</span>"`;
                html += '</div>';

                html += '<h3>üîç ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</h3>';
                
                const checks = {
                    'bank_transfer': method === 'bank_transfer',
                    'bank transfer': method === 'bank transfer',
                    'promptpay': method === 'promptpay',
                    'prompt_pay': method === 'prompt_pay'
                };

                for (const [key, value] of Object.entries(checks)) {
                    const className = value ? 'check-pass' : 'check-fail';
                    const icon = value ? '‚úÖ' : '‚ùå';
                    html += `<div class="check-item ${className}">`;
                    html += `${icon} method === "${key}": ${value}`;
                    html += '</div>';
                }

                html += '<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>';
                html += '<div class="info-box">';
                if (shouldShow) {
                    html += '<p style="color: #059669; font-size: 1.2rem; font-weight: 600;">‚úÖ ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>';
                    html += '<p>Payment method ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (bank_transfer ‡∏´‡∏£‡∏∑‡∏≠ promptpay)</p>';
                } else {
                    html += '<p style="color: #dc2626; font-size: 1.2rem; font-weight: 600;">‚ùå ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>';
                    html += `<p>Payment method: "${order.payment_method}" ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
                    
                    if (method === 'cod' || method === 'cash') {
                        html += '<p style="color: #059669;">‚úì ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</p>';
                    } else {
                        html += '<p style="color: #dc2626;">‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á</p>';
                        html += '<p><strong>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>';
                    }
                }
                html += '</div>';

                resultDiv.className = 'result success';
                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h2>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h2>
                    <p>${error.message}</p>
                    <div class="info-box">
                        <p><strong>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</strong></p>
                        <ul>
                            <li>Backend server ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (http://localhost:5000)</li>
                            <li>Order ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
                            <li>‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• order ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
                        </ul>
                    </div>
                `;
            }
        }

        // Auto check on load if order ID is provided
        window.onload = function() {
            const orderId = document.getElementById('orderId').value;
            if (orderId) {
                checkOrder();
            }
        };
    </script>
</body>
</html>
